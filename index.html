
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
        <meta name="generator" content="Hugo 0.88.1">
        <title>SWAPP</title>
        <script src="https://use.fontawesome.com/41666ba71b.js"></script>
    
        <!--<link rel="canonical" href="https://getbootstrap.com/docs/4.6/examples/album/"> -->      
    
        <!-- Bootstrap core CSS -->
    <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">   
    
        <style>
          .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
          }
    
          @media (min-width: 768px) {
            .bd-placeholder-img-lg {
              font-size: 3.5rem;
            }
          }
        </style>
    
        
        <!-- Custom styles for this template -->
        <link href="album.css" rel="stylesheet">
      </head>
      <body>
        
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-xl">
              <a class="navbar-brand" href="/">
                  <span>S W A P P</span>
                  <img src="../SWAPI/images/icon-starwars.svg">
              </a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample07XL" aria-controls="navbarsExample07XL" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
          
              <div class="collapse navbar-collapse" id="navbarsExample07XL">
                <ul class="navbar-nav mr-auto"></ul>
                <form class="form-inline my-2 my-md-0">
                  <input class="form-control" type="text" placeholder="Search" aria-label="Search">
                </form>
              </div>
            </div>
          </nav>
            
    </header>
    
    <main role="main">
    <!-- Джумботрон -->
        <section class="jumbotron jumbotron-fluid text-center">
            <div class="container">
                <h1>Star War Universe</h1>
                <p class="lead text-muted">All the Star Wars data you've ever wanted:
                    Planets, Spaceships, Vehicles, People, Films and Species
                    from all 9 Star Wars films</p>            
                <p class="lead text-muted">Now with The Force Awakens data!</p>
            </div>
        </section>

        
    <!-- Сетка персонажей -->
        <div class="album py-5 bg-dark">
            <div class="container">
                <h2>CHARACTERS</h2>   
                <div id="cards-list" class="row"></div>
            </div>


            <!-- Модальное окно -->            
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div id="modalBody" class="modal-body">
                        
                        </div>
                        <!-- <div class="modal-footer">
                            <button type="button" class="btn btn-warning" data-dismiss="modal">Закрыть</button>
                        </div> -->
                    </div>
                </div>
            </div>

            <!-- Пагинация -->
            <nav aria-label="pagination" class="pages">
                <ul id="pages" class="pagination justify-content-center"></ul>
            </nav>
        </div>    
    </main>
        
        <footer class="text-muted">
            <div class="container">
                <p class="footer__header">Follow us</p>
                <ul class="footer__list"> 
                    <li class="footer__item">
                        <a href="https://www.pinterest.com" title="SHOPNO in Pinterest"><i class="fa fa-pinterest-p"></i></a>
                    </li>
                    <li class="footer__item">
                        <a href="https://twitter.com" title="SHOPNO in Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="footer__item">
                        <a href="https://www.facebook.com" title="SHOPNO in Facebook"><i class="fa fa-facebook"></i></a>
                    </li>
                </ul>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>   
        <script>
            "use strict"
            async function loadPageData(pageNumb) {
                usersInfo.length = 0;
                try {
                    const responsePage = await fetch(`https://swapi.dev/api/people/?page=${pageNumb}`);
                    const pageData = await responsePage.json();
                    const pageCount = Math.ceil(+pageData.count/10);
                    localStorage.setItem('maxPageCount', JSON.stringify(pageCount)); 
                    for (let i = 0; i <= pageData.results.length-1; i++) {
                        usersInfo.push(pageData.results[i]);
                    }
                    showCards();           
                } catch(err) {
                    alert(err)
                }                       
            }

            function toggleActiveStatus(obj, id) {                
                obj.classList.toggle('active');
                document.getElementById(id).closest('li').classList.add('active');
            }
            
            function savePageNumber(currentPageNumbID) {
                localStorage.setItem('currentPageNumbID', JSON.stringify(currentPageNumbID));
            }

            function setPageList() {
                let pageCount = JSON.parse(localStorage.getItem('maxPageCount'));
                for (let i = 1; i <= pageCount; i++) {
                    pageList.push(`
                    <li class="page-item">
                        <a id="${i}" class="page-link" href="#">${i}</a>
                    </li>`);    
                };
                pageList.push(`
                <li class="page-item">
                    <a id="next" class="page-link" href="#">NEXT</a>
                </li>`);
                pageList.unshift(`
                <li class="page-item disabled">
                    <a id="prev" class="page-link" href="#" tabindex="-1" aria-disabled="true">PREV</a>
                </li>`);

                let str = pageList.join('');
                pages.innerHTML = str;
                init();                
            }

            function showCards() {
                let cardsList = document.getElementById('cards-list');
                cardsList.innerHTML = '';

                cardsList.innerHTML = usersInfo.map(elem => `
                <div class="col-md-3">
                    <div class="card mb-3 shadow-sm">
                        <img class='charcter_image' src="images/StarWars.jpg">
                        <div class="card-body">
                            <p class="card-text">${elem.name}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group" data-id="${usersInfo.indexOf(elem)}">
                                    <a id='btnDetails' class="btn btn-sm btn-outline-warning" data-toggle="modal" data-target="#exampleModal">Details</a>
                                </div>                                
                            </div>
                        </div>
                    </div>
                </div>`).join('');                
            }
            
            function init() {
                if (localStorage.getItem('currentPageNumbID')) {
                    let id = localStorage.getItem('currentPageNumbID'); 
                    //alert(typeof(id));                   
                    loadPageData(id);                    
                    document.getElementById(id).closest('li').classList.add('active');
                } else {                    
                    loadPageData(1);
                    document.getElementById('1').closest('li').classList.add('active');
                }
            } 
            
            async function getUserData(pageNumb, userID) {
                let cardBody = document.getElementById('modalBody');
                cardBody.innerHTML = '';
                try {
                    const serverRequest = await fetch(`https://swapi.dev/api/people/?page=${pageNumb}`);
                    const userData = await serverRequest.json();
                    
                    let modalUserName = document.getElementById('exampleModalLabel');
                    let user = userData.results[+userID];
                    modalUserName.textContent = user.name;

                    //получение Наименования планеты по url
                    let planetReq = await fetch(user.homeworld);
                    let planet = await planetReq.json();
                    //вид/раса
                    let species = '';
                    if (user.species.length === '0') {
                        species = 'n/a';
                        alert('нет вида')
                    } else {
                        console.log(user.species[0]);
                        let specReq = await fetch(user.species[0]);                        
                        let species = await specReq.json();
                        console.log(species.name, species.classification,species.designation)
                    }
                    
                    let cardBody = document.getElementById('modalBody');
                    cardBody.innerHTML = `
                    <p>Год рождения: ${user.birth_year}</p>
                    <p>Вид: ${species.name}, ${species.classification}, ${species.designation}</p>
                    <p>Пол: ${user.gender}</p>
                    <p>Планета: ${planet.name}</p>
                    <p>Рост: ${user.height}</p>
                    <p>Вес: ${user.mass}</p>
                    <p>Цвет: ${user.skin_color}</p>
                    <p>Цвет волос: ${user.hair_color}</p>
                    <p>Цвет глаз: ${user.eye_color}</p>
                    <p>Звёздный корабль: ${user.starships}</p>
                    <p>Корабль: ${user.vehicles}</p>
                    <p>Films: ${user.films}</p>
                    `                    
                } catch (error) {
                    console.error(error);
                }
            }
            
            //////  main //////
            let usersInfo = [];
            let pageList = [];
            let pages = document.getElementById('pages');
            let cardsList = document.getElementById('cards-list');
            let exampleModal = document.getElementById("exampleModal");            
            
            setPageList();
                
            let pagesCount = JSON.parse(localStorage.getItem('maxPageCount'));           
                       
            //переключение страниц
            pages.addEventListener('click', function(event) {
                let activePage = document.querySelector('.page-item.active');
                
                if (event.target.id === 'prev') {
                    let newID = +activePage.firstElementChild.id - 1;
                    if (newID !== 1) {
                        toggleActiveStatus(activePage, newID);                        
                    } else {
                        toggleActiveStatus(activePage, newID);
                        document.getElementById('prev').closest('li').classList.add('disabled');                        
                    }
                    loadPageData(newID);
                    savePageNumber(newID);
                }
                if (event.target.id === 'next') {
                    let newID = +activePage.firstElementChild.id + 1;
                    if (newID === pagesCount) {
                        toggleActiveStatus(activePage, newID);
                        document.getElementById('next').closest('li').classList.add('disabled');
                    } else {
                        toggleActiveStatus(activePage, newID);
                        document.getElementById('prev').closest('li').classList.remove('disabled');
                    }
                    loadPageData(newID);                    
                    savePageNumber(newID);            
                }
                if (event.target.id > '1' && +event.target.id < pagesCount) {
                    toggleActiveStatus(activePage, +event.target.id);
                    document.getElementById('next').closest('li').classList.remove('disabled');
                    document.getElementById('prev').closest('li').classList.remove('disabled');
                    loadPageData(+event.target.id);
                    savePageNumber(+event.target.id); 
                }
                if (+event.target.id === pagesCount) {
                    toggleActiveStatus(activePage, +event.target.id);
                    document.getElementById('next').closest('li').classList.add('disabled');
                    document.getElementById('prev').closest('li').classList.remove('disabled');
                    loadPageData(+event.target.id);
                    savePageNumber(+event.target.id);  
                }
                if (event.target.id === '1') {
                    toggleActiveStatus(activePage, +event.target.id);
                    document.getElementById('next').closest('li').classList.remove('disabled');
                    document.getElementById('prev').closest('li').classList.add('disabled');
                    loadPageData(+event.target.id);
                    savePageNumber(+event.target.id); 
                }
            });

            //нажатие кнопки Details
            cardsList.addEventListener('click', function(e) {
                if (event.target.id = 'btnDeatails') {
                    let btnID = event.target.closest('div').getAttribute('data-id');
                    let pageNumber = localStorage.getItem('currentPageNumbID');
                    getUserData(pageNumber, btnID);
                }                
            });        
        </script>
    </body>
</html>